from PIL import Image
from PIL import ImageDraw
import sys

def asciify(source, result):
    symbol = {0: ' ', 1: ' ', 2: ' ', 3: ' ', 4: ' ', 5: ' ', 6: ' ', 7: ' ', 8: ' ', 9: ' ', 10: '.', 11: '.', 12: '.', 13: '.', 14: '.', 15: '.', 16: '.', 17: '.', 18: '.', 19: '.', 20: '.', 21: '.', 22: '.', 23: '.', 24: '.', 25: '.', 26: '.', 27: '.', 28: '.', 29: '.', 30: '.', 31: '.', 32: '.', 33: '`', 34: '`', 35: '`', 36: '`', 37: '`', 38: '`', 39: '`', 40: '`', 41: '`', 42: '`', 43: '`', 44: '`', 45: '-', 46: '-', 47: '-', 48: '-', 49: '-', 50: '-', 51: '-', 52: '-', 53: '-', 54: '-', 55: '-', 56: '~', 57: '~', 58: '~', 59: '~', 60: '~', 61: '~', 62: '~', 63: '~', 64: '|', 65: '|', 66: '|', 67: '|', 68: '|', 69: '|', 70: '|', 71: '|', 72: '|', 73: '|', 74: '|', 75: '^', 76: '^', 77: '^', 78: '^', 79: '^', 80: '^', 81: '^', 82: '^', 83: '+', 84: '+', 85: '+', 86: '+', 87: '+', 88: '+', 89: '+', 90: '+', 91: '+', 92: '+', 93: '>', 94: '>', 95: '>', 96: '>', 97: '>', 98: '>', 99: '>', 100: '>', 101: '>', 102: '>', 103: '>', 104: '>', 105: '>', 106: '>', 107: '>', 108: '>', 109: '>', 110: '>', 111: '>', 112: '?', 113: '?', 114: '?', 115: '?', 116: '?', 117: '?', 118: '?', 119: '?', 120: '?', 121: '?', 122: '?', 123: '?', 124: '?', 125: '?', 126: '?', 127: '?', 128: '?', 129: '?', 130: '?', 131: '?', 132: '?', 133: '?', 134: '?', 135: '?', 136: '?', 137: '?', 138: '?', 139: '?', 140: '?', 141: '?', 142: 'v', 143: 'v', 144: 'v', 145: 'v', 146: 'v', 147: 'v', 148: 'v', 149: 'v', 150: '}', 151: '}', 152: '}', 153: '}', 154: '}', 155: '}', 156: '}', 157: '}', 158: '}', 159: '}', 160: '}', 161: 'r', 162: 'r', 163: 'r', 164: 'r', 165: 'r', 166: 'r', 167: 'r', 168: 'r', 169: 'w', 170: 'w', 171: 'w', 172: 'w', 173: 'w', 174: 'w', 175: 'w', 176: 'w', 177: 'w', 178: 'w', 179: 'z', 180: 'z', 181: 'z', 182: 'z', 183: 'z', 184: 'z', 185: 'z', 186: 'z', 187: 'x', 188: 'x', 189: 'x', 190: 'x', 191: 'x', 192: 'x', 193: 'x', 194: 'x', 195: 'x', 196: 'x', 197: 'x', 198: 'u', 199: 'u', 200: 'u', 201: 'u', 202: 'u', 203: 'u', 204: 'u', 205: 'u', 206: 'y', 207: 'y', 208: 'y', 209: 'y', 210: 'y', 211: 'y', 212: 'y', 213: 'y', 214: 'y', 215: 'y', 216: 'y', 217: 'K', 218: 'K', 219: 'K', 220: 'K', 221: 'K', 222: 'K', 223: 'K', 224: 'K', 225: 'K', 226: 'K', 227: 'K', 228: 'k', 229: 'k', 230: 'k', 231: 'k', 232: 'k', 233: 'k', 234: 'k', 235: 'k', 236: 'p', 237: 'p', 238: 'p', 239: 'p', 240: 'p', 241: 'p', 242: 'p', 243: 'p', 244: 'p', 245: 'p', 246: 'q', 247: 'q', 248: 'q', 249: 'q', 250: 'q', 251: 'q', 252: 'H', 253: 'H', 254: 'H', 255: 'H'}
    w = 6
    h = 12

    original = Image.open(source).convert('L')
    img = Image.new('L', original.size, (0))
    for c in range(original.size[0]//w):
        for r in range(original.size[1]//h):
            s = 0
            cropped = original.crop((c*w, r*h, c*w+w, r*h+h))
            for color in cropped.getcolors():
                s += color[0]*color[1]
            else:
                avg = s//(w*h)
                nueva = Image.new('L', (w,h), (0))
                draw = ImageDraw.Draw(nueva)
                draw.text((0,0), symbol[avg], (255))
                img.paste(nueva, (c*w, r*h))
    img.show()
    img.save(result)

def main():
    if len(sys.argv) != 3:
        print('Wrong input parameters count')
        print('Usage: python ascii_art.py <source image> <destiny image>')
    else:
        asciify(sys.argv[1], sys.argv[2])

if __name__ == '__main__':
    main()
